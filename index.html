<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ç«¹åŒ—è³‡æºå¤©ç§¤</title>
<style>
  /* GitHub Pages å°ˆç”¨å…¨è¢å¹•å„ªåŒ– */
  * { box-sizing: border-box; }
  body { 
    font-family: "Helvetica Neue", Helvetica, "Microsoft JhengHei", Arial, sans-serif; 
    background-color: #f0f2f5; 
    margin: 0; 
    padding: 0; 
    min-height: 100vh;
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center; /* è®“å¡ç‰‡å‚ç›´ç½®ä¸­ */
  }
  
  .container {
    width: 100%;
    max-width: 450px; /* é™åˆ¶æœ€å¤§å¯¬åº¦åƒ App */
    padding: 20px;
  }

  .card { 
    background: #fff; 
    border-radius: 16px; 
    padding: 25px; 
    width: 100%; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
    border-top: 6px solid #2c3e50; 
  }
  
  h2 { color: #2c3e50; margin: 0 0 5px 0; font-size: 22px; letter-spacing: 1px; text-align: center; }
  .sub-header { font-size: 13px; color: #7f8c8d; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; text-align: center; }
  
  .live-tag { 
    display: block; 
    background: #e8f5e9; 
    color: #2e7d32; 
    padding: 8px 12px; 
    border-radius: 6px; 
    font-size: 14px; 
    font-weight: bold; 
    margin-bottom: 20px; 
    border: 1px solid #c8e6c9; 
    text-align: center;
  }
  
  .btn { 
    background: #2c3e50; 
    color: white; 
    border: none; 
    padding: 16px 0; 
    font-size: 18px; 
    border-radius: 12px; 
    cursor: pointer; 
    width: 100%; 
    font-weight: bold; 
    transition: 0.2s; 
    box-shadow: 0 4px 12px rgba(44, 62, 80, 0.3);
  }
  .btn:active { transform: scale(0.98); }
  
  .result-area { display: none; margin-top: 25px; text-align: left; animation: popIn 0.4s ease-out; }
  @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
  
  .metric-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid #eee; }
  .metric-label { font-size: 13px; color: #555; line-height: 1.4; }
  .metric-val { font-size: 20px; font-weight: bold; color: #2c3e50; }
  
  .chief-msg-box { margin-top: 20px; background: #fff5f8; padding: 15px; border-radius: 10px; border-left: 5px solid #e91e63; display: none; }
  .chief-title { font-size: 13px; font-weight: bold; color: #e91e63; margin-bottom: 8px; display: flex; align-items: center; }
  .chief-content { font-size: 15px; color: #333; line-height: 1.6; }

  .analysis-box { margin-top: 20px; padding: 20px; border-radius: 10px; position: relative; }
  .role-badge { display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-bottom: 10px; letter-spacing: 1px; }
  .analysis-text { font-size: 15px; line-height: 1.6; font-weight: 500; }
  
  .role-guardian { background: #fff8e1; color: #856404; border: 1px solid #ffeeba; }
  .role-guardian .role-badge { background: #ffc107; color: #fff; }
  .role-noble { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
  .role-noble .role-badge { background: #17a2b8; color: #fff; }
  .role-citizen { background: #e2e3e5; color: #383d41; border: 1px solid #d6d8db; }
  .role-citizen .role-badge { background: #6c757d; color: #fff; }
  
  .footer { margin-top: 25px; font-size: 12px; color: #aaa; text-align: center; padding-bottom: 10px; }
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <h2>âš–ï¸ ç«¹åŒ—è³‡æºå¤©ç§¤</h2>
    <div class="sub-header">åŸå¸‚ç™¼å±•æ•¸æ“šåˆ†æå„€ v3.0</div>
    
    <div id="eventStatus" class="live-tag">é€£ç·šä¸­...</div>
    
    <p style="font-size: 14px; color: #666; margin-bottom: 20px; text-align: center; line-height: 1.6;">
      è¼¸å…¥æ‚¨çš„ä½ç½®ï¼Œ<br>æª¢è¦–é€™å ´æ´»å‹•å°æ‚¨çš„ã€Œç´ç¨…æ•ˆç›Šã€ã€‚
    </p>

    <button class="btn" onclick="getLocation()">ğŸ“ å•Ÿå‹•å®šä½åˆ†æ</button>

    <div id="output" class="result-area">
      <div class="metric-row">
        <div class="metric-label">é›¢æœ¬é€±ç„¦é»<br><span id="goodName" style="font-size:12px; color:#999;">...</span></div>
        <div class="metric-val" id="goodDist">...</div>
      </div>
      
      <div class="metric-row">
        <div class="metric-label">é›¢åƒè€ƒæŒ‡æ¨™<br><span id="badName" style="font-size:12px; color:#999;">...</span></div>
        <div class="metric-val" id="badDist">...</div>
      </div>

      <div id="chiefBox" class="chief-msg-box">
        <div class="chief-title">ğŸ“¢ é‡Œé•·ç­†è¨˜</div>
        <div class="chief-content" id="chiefMsg">...</div>
      </div>

      <div id="analysisBox" class="analysis-box">
        <div id="roleBadge" class="role-badge">åˆ†æä¸­</div>
        <div id="analysisText" class="analysis-text"></div>
      </div>
    </div>
    
    <div class="footer">
      æœ¬å·¥å…·åƒ…ä¾›å¸‚æ”¿è¨è«–åƒè€ƒ<br>Designed for Zhubei West
    </div>
  </div>
</div>

<script>
  // â˜…â˜…â˜… è«‹åœ¨é€™è£¡è²¼ä¸Šæ‚¨çš„ CSV ç¶²å€ â˜…â˜…â˜…
  var sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQtIyD2tguRY3fN-Pe9Fwe-07P_0MWG8G7Z6XNfOE9qpk2U-b_NjBRpA26o4FenSxkQMpbfvCLjyu46/pubhtml'; 
  // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…

  var eventData = {
    name: "è³‡æ–™è®€å–ä¸­", lat: 24.8135, lng: 121.0265,
    badName: "è®€å–ä¸­", badLat: 24.8550, badLng: 120.9650,
    chiefMsg: ""
  };

  window.onload = function() {
    fetch(sheetUrl)
      .then(response => response.text())
      .then(data => {
        var rows = data.split('\n');
        var cols = rows[1].split(','); 
        function clean(str) { return str ? str.replace(/"/g, '').trim() : ""; }

        if(cols.length >= 6) {
           eventData.name = clean(cols[0]);
           eventData.lat = parseFloat(cols[1]);
           eventData.lng = parseFloat(cols[2]);
           eventData.badName = clean(cols[3]);
           eventData.badLat = parseFloat(cols[4]);
           eventData.badLng = parseFloat(cols[5]);
           if(cols.length >= 7) eventData.chiefMsg = clean(cols[6]);

           document.getElementById('eventStatus').innerText = "â— ç›®å‰è¿½è¹¤ï¼š" + eventData.name;
           document.getElementById('goodName').innerText = eventData.name;
           document.getElementById('badName').innerText = eventData.badName;
        }
      });
  };

  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPos, showErr);
    } else {
      alert("æ‚¨çš„è£ç½®ä¸æ”¯æ´å®šä½");
    }
  }

  function showPos(position) {
    calc(position.coords.latitude, position.coords.longitude);
  }

  function showErr(error) {
    alert("ç„¡æ³•æŠ“å–ä½ç½®ï¼Œå°‡åˆ‡æ›è‡³ã€è¥¿å€æ¨¡æ“¬è¦–è§’ã€‘ã€‚");
    calc(24.845, 120.970); 
  }

  function calc(lat, lng) {
    let dGood = getDist(lat, lng, eventData.lat, eventData.lng);
    let dBad = getDist(lat, lng, eventData.badLat, eventData.badLng);
    
    document.getElementById("goodDist").innerText = dGood.toFixed(1) + " km";
    document.getElementById("badDist").innerText = dBad.toFixed(1) + " km";
    
    if(eventData.chiefMsg && eventData.chiefMsg.length > 1) {
      document.getElementById("chiefMsg").innerText = eventData.chiefMsg;
      document.getElementById("chiefBox").style.display = "block";
    } else {
      document.getElementById("chiefBox").style.display = "none";
    }

    let role = ""; let text = ""; let styleClass = "";
    
    if (dGood > 5.0 && dBad < 3.0) {
      role = "åŸå¸‚å®ˆè­·è€…";
      text = "ç¹è¯çš„æ´»å‹•é›¢æ‚¨å¾ˆé ï¼Œä½†åŸå¸‚çš„è²¬ä»»ï¼ˆ" + eventData.badName + "ï¼‰é›¢æ‚¨å¾ˆè¿‘ã€‚æ„Ÿè¬æ‚¨æ‰¿æ“”äº†ç«¹åŒ—çš„é‹è½‰é‡ä»»ã€‚";
      styleClass = "role-guardian";
    } else if (dGood < 3.0 && dBad > 5.0) {
      role = "è³‡æºæ ¸å¿ƒå€";
      text = "æ‚¨ä½æ–¼ç«¹åŒ—è³‡æºæœ€è±å¯Œçš„å€åŸŸã€‚è«‹åˆ¥å¿˜äº†ï¼Œæ‚¨ç”Ÿæ´»çš„ä¾¿åˆ©ï¼ŒèƒŒå¾Œæœ‰è¥¿å€å±…æ°‘åœ¨é»˜é»˜æ”¯æ’ã€‚";
      styleClass = "role-noble";
    } else {
      role = "ä¸€èˆ¬å¸‚æ°‘";
      text = "è©¦è‘—æ¯”è¼ƒé€™å…©å€‹è·é›¢ï¼Œæ‚¨èªç‚ºç«¹åŒ—çš„æ±ã€è¥¿å€ç™¼å±•ï¼Œç›®å‰æ˜¯å¹³è¡¡çš„å—ï¼Ÿ";
      styleClass = "role-citizen";
    }
    
    let box = document.getElementById("analysisBox");
    box.className = "analysis-box " + styleClass;
    document.getElementById("roleBadge").innerText = role;
    document.getElementById("analysisText").innerText = text;
    document.getElementById("output").style.display = "block";
  }

  function getDist(lat1,lon1,lat2,lon2) {
    var R = 6371; 
    var dLat = (lat2-lat1) * (Math.PI/180);
    var dLon = (lon2-lon1) * (Math.PI/180);
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1*(Math.PI/180)) * Math.cos(lat2*(Math.PI/180)) * Math.sin(dLon/2) * Math.sin(dLon/2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
    return R * c;
  }
</script>
</body>
</html>
