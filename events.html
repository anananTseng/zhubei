<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç«¹åŒ—å¸‚æ´»å‹•æ˜ç´°</title>
<style>
  body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f0f2f5; margin: 0; padding: 15px; color: #333; }
  .container { max-width: 600px; margin: 0 auto; }
  
  /* é ‚éƒ¨å°èˆª */
  .nav-bar { display: flex; align-items: center; margin-bottom: 20px; }
  .back-btn { 
    text-decoration: none; background: #fff; color: #2c3e50; padding: 8px 15px; 
    border-radius: 20px; font-weight: bold; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    display: flex; align-items: center;
  }
  .back-btn:before { content: "â†"; margin-right: 5px; }
  .page-title { margin-left: 15px; font-size: 18px; font-weight: bold; color: #2c3e50; }

  /* å¡ç‰‡åˆ—è¡¨ */
  .event-list { display: flex; flex-direction: column; gap: 15px; }
  
  .event-card { 
    background: #fff; border-radius: 12px; padding: 20px; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 5px solid #bdc3c7; /* é è¨­ç°è‰² */
    transition: transform 0.2s; position: relative;
  }
  
  /* è‡ªå‹•åˆ¤æ–·é¡è‰² */
  .color-west { border-left-color: #27ae60; } /* ç¶ è‰² */
  .color-east { border-left-color: #e67e22; } /* æ©˜è‰² */

  .meta-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
  .date-badge { background: #2c3e50; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: bold; }
  .organizer { font-size: 12px; color: #7f8c8d; background: #ecf0f1; padding: 4px 8px; border-radius: 4px; }
  
  .event-name { font-size: 18px; font-weight: bold; margin-bottom: 10px; line-height: 1.4; color: #2c3e50; }
  
  .loc-row { display: flex; align-items: center; color: #2980b9; font-size: 14px; margin-bottom: 15px; cursor: pointer; }
  .loc-icon { margin-right: 5px; }
  
  .link-btn { 
    display: block; text-align: center; background: #fff; border: 1px solid #2c3e50; 
    color: #2c3e50; padding: 10px; border-radius: 8px; text-decoration: none; 
    font-weight: bold; font-size: 14px; transition: 0.2s;
  }
  .link-btn:hover { background: #2c3e50; color: #fff; }
  .no-link { display: none; } /* æ²’é€£çµå°±éš±è— */

  .loading { text-align: center; color: #999; margin-top: 50px; }
  .error-box { background: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; text-align: center; display: none; }
</style>
</head>
<body>

<div class="container">
  <div class="nav-bar">
    <a href="index.html" class="back-btn">å›å¤©ç§¤ä¸»é </a>
    <div class="page-title">ç«¹åŒ—å¸‚æ´»å‹•æ˜ç´°</div>
  </div>

  <div id="errorArea" class="error-box"></div>
  <div id="list" class="event-list">
    <div class="loading">æ­£åœ¨è¼‰å…¥æœ€æ–°æ´»å‹•è³‡è¨Š...</div>
  </div>
</div>

<script>
  // â˜…â˜…â˜… è«‹è²¼ä¸Šã€Œç«¹åŒ—å¸‚æ´»å‹•æ˜ç´°ã€Excel çš„ CSV ç¶²å€ â˜…â˜…â˜…
  var sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ-St7MX96Iy6KCTUt15jzZEm2H8WVF8pK4iJj4qL7j2oTCxCKopoak0xgHq5RzjKNEmO7JgsXF389i/pub?output=csv'; 
  // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…

  // å¼·åŠ› CSV è§£æ (ä¸æ€•é€—è™Ÿ)
  function parseCSV(text) {
    const rows = []; let currentRow = []; let cell = ''; let inQuote = false;
    for (let i = 0; i < text.length; i++) {
        const c = text[i];
        if (c === '"') { inQuote = !inQuote; }
        else if (c === ',' && !inQuote) { currentRow.push(cell.trim()); cell = ''; }
        else if ((c === '\r' || c === '\n') && !inQuote) {
            if (cell || currentRow.length) currentRow.push(cell.trim());
            if (currentRow.length) rows.push(currentRow);
            currentRow = []; cell = '';
        } else { cell += c; }
    }
    if (cell || currentRow.length) { currentRow.push(cell.trim()); rows.push(currentRow); }
    return rows;
  }

  window.onload = function() {
    fetch(sheetUrl)
      .then(res => { if(!res.ok) throw new Error("é€£ç·šå¤±æ•—"); return res.text(); })
      .then(text => {
        try {
            var rows = parseCSV(text);
            var html = "";
            
            // å¾ç¬¬ 2 åˆ—é–‹å§‹è®€å– (è·³éæ¨™é¡Œ)
            for(var i=1; i<rows.length; i++) {
                var col = rows[i];
                // ç¢ºä¿è‡³å°‘æœ‰å‰ 4 æ¬„ (æ—¥æœŸ, åç¨±, ä¸»è¾¦, åœ°é»)
                if(col.length < 4) continue;

                var date = col[0];      // Aæ¬„
                var title = col[1];     // Bæ¬„
                var org = col[2];       // Cæ¬„
                var loc = col[3];       // Dæ¬„
                var link = col[4] || ""; // Eæ¬„ (å¯èƒ½ç‚ºç©º)

                // è‡ªå‹•åˆ¤æ–·é¡è‰² (æ ¹æ“šåœ°é»æ–‡å­—)
                var colorClass = "";
                if(loc.includes("è¥¿å€") || loc.includes("æ–°æœˆ") || loc.includes("æ‹”å­çªŸ")) colorClass = "color-west";
                else if(loc.includes("æ±å€") || loc.includes("æ°´åœ³") || loc.includes("é«˜éµ")) colorClass = "color-east";

                // Google å°èˆªé€£çµ
                var mapLink = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(loc);

                html += `
                <div class="event-card ${colorClass}">
                    <div class="meta-row">
                        <span class="date-badge">${date}</span>
                        <span class="organizer">${org}</span>
                    </div>
                    <div class="event-name">${title}</div>
                    
                    <div class="loc-row" onclick="window.open('${mapLink}')">
                        <span class="loc-icon">ğŸ“</span>${loc} (å°èˆª)
                    </div>

                    ${link.startsWith('http') ? 
                      `<a href="${link}" target="_blank" class="link-btn">ğŸ”— æŸ¥çœ‹å®˜æ–¹è³‡è¨Š</a>` : 
                      `<span class="no-link"></span>`
                    }
                </div>
                `;
            }
            
            if(html === "") html = "<div style='text-align:center;color:#999'>ç›®å‰æ²’æœ‰æ´»å‹•è³‡æ–™</div>";
            document.getElementById('list').innerHTML = html;

        } catch(e) {
            throw new Error("è³‡æ–™è§£æéŒ¯èª¤ï¼š" + e.message);
        }
      })
      .catch(err => {
        document.getElementById('list').style.display = 'none';
        var box = document.getElementById('errorArea');
        box.style.display = 'block';
        box.innerHTML = "âš ï¸ ç„¡æ³•è®€å–è³‡æ–™åº«<br>è«‹æª¢æŸ¥ Excel ç¶²å€æ˜¯å¦æ­£ç¢ºç™¼å¸ƒç‚º CSVã€‚";
      });
  };
</script>
</body>
</html>
